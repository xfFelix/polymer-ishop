import $http from'jquery';import ENV from'./config';function merge(a,b){for(var c in'object'!==('undefined'===typeof b?'undefined':babelHelpers.typeof(b))&&(b={}),b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}var request={currentUser:function(){return'\u7528\u6237\u4FE1\u606F'},makeUrl:function(a){return ENV.baseURL.replace(/\/$/,'')+'/'+a},makeRequest:function(a,b,c,d){var e=merge({url:a,type:'GET',dataType:'json',contentType:'application/json',headers:{Accept:'application/json'}},b||{});if(b&&b.data&&(e.data=b.data),b&&b.needAuth){delete e.needAuth;var f=localStorage.getItem('accessToken');e.headers['Authentication-Token']=f}return b&&b.loading&&console.info('start loading '+e.url),new Promise(function(a,b){var f=$http[e.type.toLowerCase()](e.url);e.headers&&f.set(e.headers),'get'===e.type.toLowerCase()&&e.data&&f.query(e.data),e.contentType&&f.type(e.contentType),'get'!==e.type.toLowerCase()&&e.data&&f.send(JSON.stringify(e.data)),f.end(function(e,f){return e?(c&&c(),console.error(e),b(e)):void(console.info(f),f&&(d&&d(f),200===f.body.code||400===f.body.code?a(f.body):203===f.body.code?localStorage.clear():(!0===f.body||!1===f.body)&&a(f.body)))})})},fetch:function(a,b,c,d){if(b&&!0===b.fullUrl)return this.makeRequest(a,b);var e=ENV.serverRootUrl.replace(/\/$/,''),f=a.replace(/^\//,'');return b&&!1===b.urlAssemble?this.makeRequest(e+'/'+f,b):this.makeRequest(this.makeUrl(f),b,c,d)}};export default request;