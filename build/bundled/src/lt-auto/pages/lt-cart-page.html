<html><head></head><body><dom-module id="lt-cart-page"><template><style include="lt-style">:host{font-size:14px;width:100%;min-height:500px;display:block;padding:15px 25px;box-sizing:border-box;background:#fff;}.pageContainer{min-height:500px;}.header{color:rgba(0,0,0,0.6);width:100%;}.header span:last-child{color :var(--app-primary-blue);}.carBox{width:100%;text-align:center;margin-top:20px;}.carBox table{width:100%;border-collapse:collapse;margin:0 auto;}.carBox table tr td{border :1px solid #ddd;padding:10px;}.carBox table thead{background:#F5F5F5;}.carBox table tbody{background:#fff;}.carBox .imgBox{width:18%;}.name{font-weight:bold;display:inline-block;margin-right:10px;font-size:18px;}.name:hover{color:var(--app-primary-red);}.price{font-size:30px;color:red;}.price::before{content:"￥";font-size:14px;color:#4A4A4A;}.del{font-size:30px;transition:all .5s;}.del:hover{transform:scale(1.5);color:#f00;}.shopping{background:#EA2225;border:2px solid #EA2225;color:#fff;display:inline-flex;padding:10px;border-radius:2px;margin-left:20px;}.shopping img{width:20px;height:20px;margin-right:5px;}.footer{margin-top:20px;text-align:right;}@media screen and (max-width:620px){:host{padding:10px;}.name{font-size:16px;margin:0;}.carBox table tr td{padding:5px;}lt-num-count{min-width:85px;}}</style><div class="pageContainer"><div class="header">当前位置：<span>首页</span> &gt; <span>购物车</span></div><div class="carBox"><table><thead><tr><td>图片</td><td>商品</td><td>种类</td><td>数量</td><td>单价</td><td>商品操作</td></tr></thead><tbody><template is="dom-repeat" items="{{productList}}"><tr><td class="imgBox"><img src="{{item.img1Url}}" width="100%"></td><td><span class="name" style="cursor: pointer;" on-click="getProductDetail">{{item.productName}}</span></td><td><span>{{item.type}}</span></td><td><lt-num-count num="{{item.stock}}"></lt-num-count></td><td><span class="price">{{item.sellingPrice}}</span></td><td class="del" on-click="_del">x</td></tr></template></tbody></table></div><div class="footer"><div class="inline">总价：<div class="inline price">{{totalPrice}}</div></div><span class="shopping" on-click="_showPurchase"><img src="./images/shopping-cart.svg">全部购买</span></div></div><lt-pop opened="{{isOpened}}"><lt-purchase-element id="purchaseEle" wechat-code="{{wechatCode}}" on-cancel="_cancel" ali-code="{{aliCode}}" status-id="{{transactionId}}" on-success="_paySuccess"></lt-purchase-element></lt-pop><iron-ajax id="getCart" method="POST" headers="{{header}}" body="{}" url="{{_calUserUrl('order/shopping/getShoppingCart')}}" content-type="application/json" handle-as="json" on-response="_responseGetCart"></iron-ajax><iron-ajax id="delReq" method="POST" headers="{{header}}" url="{{_calUserUrl('order/shopping/deleteShoppingCart')}}" content-type="application/json" handle-as="json" on-response="_responseDel"></iron-ajax><iron-ajax id="createOrder" method="POST" headers="{{header}}" url="{{_calUserUrl('order/shopping/createOrder')}}" content-type="application/json" handle-as="json" on-response="_responsOrder"></iron-ajax><iron-ajax id="getQrcode" method="POST" url="{{_calPayUrl('shop/qrCodePay')}}" content-type="application/json" handle-as="json" on-response="_responQrcode"></iron-ajax></template><script>var ltCartPage=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"_paySuccess",value:function(){this.$.getCart.generateRequest()}},{key:"_responQrcode",value:function(a){for(var b=a.detail.response,c=0;c<b.length;c++)"WeChatPay"==b[c].platform&&(this.wechatCode=b[c].qrCodeByte),"AliPay"==b[c].platform&&(this.aliCode=b[c].qrCodeByte);this.isOpened=!0}},{key:"_responsOrder",value:function(a){var b=a.detail.response;return"-1"==b.status?void this.dispatchEvent(new CustomEvent("confirm",{detail:{msg:b.message},bubbles:!0,composed:!0})):void(this.transactionId=b.transactionId,this.$.getQrcode.body={outTradeNumber:b.transactionId,body:b.attach},this.$.getQrcode.generateRequest())}},{key:"_cancel",value:function(){this.isOpened=!1}},{key:"_checkTotalPrice",value:function(a){if(a.base){var b=0;a.base.forEach(function(a){b+=+a.sellingPrice*+a.stock}),this.totalPrice=b}}},{key:"_del",value:function(a){var b=a.model.__data.item;this.$.delReq.body={shoppingCartUidList:[b.shoppingCartUid]},this.$.delReq.generateRequest()}},{key:"_responseDel",value:function(){this.$.getCart.generateRequest()}},{key:"_responseGetCart",value:function(a){this.productList=a.detail.response.datas||[]}},{key:"_showPurchase",value:function(){if(0!=this.productList.length){for(var a=[],b=[],c=0;c<this.productList.length;c++)a.push({num:this.productList[c].stock,productCode:this.productList[c].productCode,type:this.productList[c].type}),b.push(this.productList[c].shoppingCartUid);this.$.createOrder.body={datas:a,fromShoppingCart:"1",shoppingCartUidList:b},this.$.createOrder.generateRequest()}}},{key:"getProductDetail",value:function(a){var b=a.model.item.productUid;location.hash="#/product-detail/"+b}},{key:"show",value:function(){this.style.display="block",header["X-CustomToken"]?this.$.getCart.generateRequest():(this.dispatchEvent(new CustomEvent("confirm",{detail:{msg:"\u8BF7\u5148\u767B\u5F55!"},bubbles:!0,composed:!0})),setTimeout(function(){location.hash="#/home"},2e3))}},{key:"hide",value:function(){this.dispatchEvent(new CustomEvent("hide",{}),!1),this.style.display="none"}}],[{key:"is",get:function(){return"lt-cart-page"}},{key:"properties",get:function(){return{isOpened:{type:Boolean,value:!1},productList:{type:Array}}}},{key:"observers",get:function(){return["_checkTotalPrice(productList.*)"]}}]),b}(ltMixin(Polymer.Element));customElements.define(ltCartPage.is,ltCartPage);</script></dom-module></body></html>